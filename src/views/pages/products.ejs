<%- include('../partials/header') %>

  <h1 class="text-3xl font-bold mb-6 p-6">Produkty</h1>

  <div class="max-w-4xl mx-auto px-6 mb-6">
    <div class="flex flex-wrap gap-4 items-center justify-between bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
      <div class="flex gap-2 flex-wrap">
        <a href="/products"
          class="px-4 py-2 <%= !selectedCategory ? 'bg-blue-600 text-white' : 'bg-white dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600' %> rounded transition">
          Wszystkie
        </a>
        <a href="/products?category=Electronics"
          class="px-4 py-2 <%= selectedCategory === 'Electronics' ? 'bg-blue-600 text-white' : 'bg-white dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600' %> rounded transition">
          Electronics
        </a>
        <a href="/products?category=Accessories"
          class="px-4 py-2 <%= selectedCategory === 'Accessories' ? 'bg-blue-600 text-white' : 'bg-white dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600' %> rounded transition">
          Accessories
        </a>
      </div>

      <select onchange="window.location.href='/products?category=<%= selectedCategory %>&sort=' + this.value"
        class="px-4 py-2 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded">
        <option value="newest" <%=selectedSort==='newest' ? 'selected' : '' %>>Najnowsze</option>
        <option value="price-asc" <%=selectedSort==='price-asc' ? 'selected' : '' %>>Cena: rosnąco</option>
        <option value="price-desc" <%=selectedSort==='price-desc' ? 'selected' : '' %>>Cena: malejąco</option>
        <option value="name-asc" <%=selectedSort==='name-asc' ? 'selected' : '' %>>Nazwa: A-Z</option>
      </select>
    </div>
  </div>

  <div class="max-w-4xl mx-auto space-y-6 p-6">
    <% products.forEach((product, index)=> { %>
      <div
        class="border p-6 rounded shadow dark:border-gray-700 bg-white dark:bg-gray-800 grid grid-cols-[300px_1fr] gap-6">

        <% if (product.images?.length> 0) { %>
          <a href="/products/<%= product._id %>" class="relative group block">
            <div class="carousel bg-gray-100 dark:bg-gray-800 rounded" data-carousel="<%= index %>">
              <% product.images.forEach((img, imgIndex)=> { %>
                <img src="<%= img %>" alt="<%= product.name %>"
                  class="carousel-image w-full h-64 object-contain rounded <%= imgIndex === 0 ? '' : 'hidden' %>"
                  data-index="<%= imgIndex %>">
                <% }) %>
            </div>

            <% if (product.images.length> 1) { %>
              <button
                class="carousel-prev absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                data-carousel="<%= index %>" aria-label="Poprzednie">←</button>
              <button
                class="carousel-next absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                data-carousel="<%= index %>" aria-label="Następne">→</button>

              <div class="flex justify-center gap-2 absolute bottom-2 left-1/2 -translate-x-1/2">
                <% product.images.forEach((img, dotIndex)=> { %>
                  <div class="w-2 h-2 rounded-full <%= dotIndex === 0 ? 'bg-white' : 'bg-white/50' %>"
                    data-dot="<%= index %>-<%= dotIndex %>"></div>
                  <% }) %>
              </div>
              <% } %>
          </a>
          <% } %>

            <div class="flex flex-col">
              <a href="/products/<%= product._id %>" class="hover:underline">
                <h2 class="text-2xl font-bold mb-1">
                  <%= product.name %>
                </h2>
              </a>
              <% if (product.description) { %>
                <p class="text-gray-500 dark:text-gray-400 text-sm mb-3 italic">
                  <%= product.description %>
                </p>
                <% } %>
                  <p class="text-green-600 dark:text-green-400 font-bold text-2xl mb-3">
                    <%= product.price.toFixed(2).replace('.', ',' ) %> zł
                  </p>
                  <p class="text-gray-700 dark:text-gray-300 mb-4 whitespace-pre-line line-clamp-3">
                    <%= product.details || 'Brak szczegółowego opisu produktu' %>
                  </p>
                  <div class="mt-auto flex gap-2">
                    <button
                      class="add-to-cart flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded transition-colors"
                      data-product-id="<%= product._id %>" data-product-name="<%= product.name %>"
                      data-product-price="<%= product.price %>"
                      data-product-image="<%= product.images?.[0] || '' %>">Dodaj do koszyka</button>
                    <a href="/products/<%= product._id %>"
                      class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-3 px-6 rounded transition-colors">
                      Szczegóły
                    </a>
                  </div>
            </div>

      </div>
      <% }) %>
  </div>

  <% if (totalPages> 1) { %>
    <div class="max-w-4xl mx-auto p-6">
      <nav class="flex justify-center items-center gap-2" aria-label="Paginacja">
        <% if (currentPage> 1) { %>
          <a href="?page=<%= currentPage - 1 %><%= searchQuery ? '&q=' + searchQuery : '' %>"
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">← Poprzednia</a>
          <% } %>

            <% for (let i=1; i <=totalPages; i++) { %>
              <a href="?page=<%= i %><%= searchQuery ? '&q=' + searchQuery : '' %>"
                class="px-4 py-2 <%= currentPage === i ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600' %> rounded transition-colors"
                aria-current="<%= currentPage === i ? 'page' : undefined %>">
                <%= i %>
              </a>
              <% } %>

                <% if (currentPage < totalPages) { %>
                  <a href="?page=<%= currentPage + 1 %><%= searchQuery ? '&q=' + searchQuery : '' %>"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">Następna →</a>
                  <% } %>
      </nav>
    </div>
    <% } %>

      <%- include('../partials/footer') %>